---
import { getEntryBySlug } from 'astro:content';
import { marked } from 'marked';
import BaseLayout from '../layouts/BaseLayout.astro';
import { formatDefaultDate } from '../lib/dates';
import HeaderSlug from '../components/HeaderSlug.astro';

const entry = await getEntryBySlug('pages', 'now');

if (!entry) {
  throw new Error('Now page content missing');
}

const formatted = entry.data.today ? formatDefaultDate(entry.data.today) : '';
const markdown = entry.body.replace('{{ today | defaultDate }}', formatted);
const html = await marked.parse(markdown);
---
<BaseLayout title={entry.data.title} currentPath="/now/">
  <section>
    <HeaderSlug />

    <div class="leading-relaxed post" set:html={html} />
  </section>
</BaseLayout>
